import{bL as m,bM as f,bN as y,bE as g,B as d,bO as O,bP as p,h as b,bQ as o,a9 as l,bR as T}from"./index-C-v0kovF.js";async function h(e){const i=await p(e);return Object.keys(i).map(a=>{let t=i[a];return(typeof t!="string"||!t.startsWith("0x"))&&(t=b(t)),[a,t]}).reduce((a,t)=>{let[n,r]=t;return{...a,[n]:r}},{})}async function _(e,i,a){const t=await p(e),n={sender:t.sender,nonce:t.nonce,initCodeHash:o(t.initCode),callDataHash:o(t.callData),callGasLimit:t.callGasLimit,verificationGasLimit:t.verificationGasLimit,preVerificationGas:t.preVerificationGas,maxFeePerGas:t.maxFeePerGas,maxPriorityFeePerGas:t.maxPriorityFeePerGas,paymasterAndDataHash:o(t.paymasterAndData)},r={components:[{type:"address",name:"sender"},{type:"uint256",name:"nonce"},{type:"bytes32",name:"initCodeHash"},{type:"bytes32",name:"callDataHash"},{type:"uint256",name:"callGasLimit"},{type:"uint256",name:"verificationGasLimit"},{type:"uint256",name:"preVerificationGas"},{type:"uint256",name:"maxFeePerGas"},{type:"uint256",name:"maxPriorityFeePerGas"},{type:"bytes32",name:"paymasterAndDataHash"}],name:"hashedUserOp",type:"tuple"},s=l.encode([r],[{...n}]),c=o(s),u=l.encode(["bytes32","address","uint256"],[c,i,a]);return o(u)}const U=()=>{const e=BigInt(Math.floor(Math.random()*4294967296)),i=BigInt(Math.floor(Math.random()*4294967296)),a=BigInt(Math.floor(Math.random()*4294967296)),t=BigInt(Math.floor(Math.random()*4294967296)),n=BigInt(Math.floor(Math.random()*4294967296)),r=BigInt(Math.floor(Math.random()*4294967296));return e<<BigInt(160)|i<<BigInt(128)|a<<BigInt(96)|t<<BigInt(64)|n<<BigInt(32)|r},G=()=>{let e=U().toString(16);return e.length%2!==0&&(e="0"+e),e="0x"+e,d.from(T([e,"0x0000000000000000"]))};class w{constructor(i,a,t,n,r){this.bundlerUrl=i,this.entryPointAddress=a,this.chainId=t;const s={};if(m(this.bundlerUrl)){const c=typeof globalThis<"u"&&"APP_BUNDLE_ID"in globalThis?globalThis.APP_BUNDLE_ID:void 0;r?s["x-secret-key"]=r:n&&(s["x-client-id"]=n,c&&(s["x-bundle-id"]=c)),typeof globalThis<"u"&&"TW_AUTH_TOKEN"in globalThis&&typeof globalThis.TW_AUTH_TOKEN=="string"&&(s.authorization=`Bearer ${globalThis.TW_AUTH_TOKEN}`),typeof globalThis<"u"&&"TW_CLI_AUTH_TOKEN"in globalThis&&typeof globalThis.TW_CLI_AUTH_TOKEN=="string"&&(s.authorization=`Bearer ${globalThis.TW_CLI_AUTH_TOKEN}`,s["x-authorize-wallet"]="true"),f(s)}this.userOpJsonRpcProvider=new y({url:this.bundlerUrl,headers:s},{name:"Connected bundler network",chainId:t}),this.initializing=this.validateChainId()}async validateChainId(){if(await g(this.chainId))return;const i=await this.userOpJsonRpcProvider.send("eth_chainId",[]),a=parseInt(i);if(a!==this.chainId)throw new Error(`bundler ${this.bundlerUrl} is on chainId ${a}, but provider is on chainId ${this.chainId}`)}async sendUserOpToBundler(i){await this.initializing;const a=await h(i),t=[a,this.entryPointAddress];return await this.printUserOperation("eth_sendUserOperation",t),await this.userOpJsonRpcProvider.send("eth_sendUserOperation",[a,this.entryPointAddress])}async estimateUserOpGas(i){await this.initializing;const a=await h(i),t=[a,this.entryPointAddress];await this.printUserOperation("eth_estimateUserOperationGas",t);const n=await this.userOpJsonRpcProvider.send("eth_estimateUserOperationGas",[a,this.entryPointAddress]);return{preVerificationGas:d.from(n.preVerificationGas),verificationGas:d.from(n.verificationGas),verificationGasLimit:d.from(n.verificationGasLimit),callGasLimit:d.from(n.callGasLimit).add(O)}}async getUserOperationGasPrice(){return await this.initializing,await this.userOpJsonRpcProvider.send("thirdweb_getUserOperationGasPrice",[])}async getUserOperationReceipt(i){return await this.initializing,await this.userOpJsonRpcProvider.send("eth_getUserOperationReceipt",[i])}async zkPaymasterData(i){return await this.initializing,await this.userOpJsonRpcProvider.send("zk_paymasterData",[await h({...i,gas:i.gasLimit})])}async zkBroadcastTransaction(i){return await this.initializing,await this.userOpJsonRpcProvider.send("zk_broadcastTransaction",[i])}async printUserOperation(i,a){}}export{w as H,_ as g,h,G as r};
